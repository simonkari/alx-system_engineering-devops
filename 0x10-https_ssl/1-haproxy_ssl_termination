#!/bin/bash

# Install HAProxy
sudo apt-get update
sudo apt-get install -y haproxy

# Install Certbot
sudo apt-get install -y certbot python3-certbot-nginx

# Request an SSL certificate for your subdomain
sudo certbot certonly --standalone -d www.your_subdomain.com -m your_email@example.com

# Create or edit the HAProxy configuration file
cat <<EOL | sudo tee /etc/haproxy/haproxy.cfg
frontend www-https
    bind *:443 ssl crt /etc/letsencrypt/live/www.your_subdomain.com/fullchain.pem
    reqadd X-Forwarded-Proto:\ https
    default_backend www-backend

backend www-backend
    server web-server 127.0.0.1:80
EOL

# Test the HAProxy configuration
sudo haproxy -c -f /etc/haproxy/haproxy.cfg

# Restart HAProxy
sudo service haproxy restart

# Display a message indicating completion
echo "HAProxy setup for SSL termination is complete."

